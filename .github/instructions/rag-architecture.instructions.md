## RAG 数据流架构模式

### 规则：理解并实现完整的 RAG 数据管道

RAG (Retrieval-Augmented Generation) 架构是系统的核心，包含完整的数据写入和读取流程。

#### 数据写入流程（Go 微服务负责）
1. **数据捕获**: Debezium 监控 PostgreSQL WAL 日志，捕获数据变更事件
2. **数据富化**: Flink 作业消费原始数据，进行业务逻辑处理和数据增强
3. **富化数据发布**: 处理后的数据写回 Kafka 新 Topic（如 `topic_rich_data`）
4. **向量处理**: Go 微服务集群订阅富化数据 Topic，调用向量化模型 (Qwen-Embedding) 将文本转换为向量
5. **索引写入**: 将向量化的数据写入 Elasticsearch，建立可搜索的索引

#### 数据读取流程（Go + Python 协作）
1. **用户查询**: Kratos 服务接收查询请求
2. **向量检索**: Go 服务调用 Python AI 服务接口，传递用户问题进行向量化搜索
3. **上下文组装**: Go 服务根据返回的文档 ID 从缓存/数据库获取完整内容
4. **答案生成**: Go 服务再次调用 Python AI 服务，传递问题和上下文生成答案
5. **返回结果**: Go 服务将最终答案返回给用户

#### 职责边界
- **Go (Kratos) 服务**:
  - 数据管道处理和流式消费
  - 向量化和索引写入 Elasticsearch
  - 业务流程编排和高可用控制
  - 缓存管理和数据访问

- **Python AI 服务**:
  - 向量检索和相似度搜索
  - 大语言模型调用和答案生成
  - 提示词工程和模型管理

#### 代码生成规则
- **Go 微服务**: 负责 Kafka 消费者、向量化模型调用、Elasticsearch 客户端操作
- **Python 服务**: 提供 REST API 接口供 Go 服务调用，内部处理向量搜索和 LLM 生成
- **错误处理**: 统一的错误响应格式，包含重试和熔断机制
- **监控**: 关键指标监控（延迟、成功率、资源使用）

#### 技术实现要点
- **Kafka Topics**: 区分原始数据 Topic 和富化数据 Topic
- **向量化**: 使用 **Qwen-Embedding-0.6B** 模型进行文本向量化
- **索引策略**: Elasticsearch 索引设计支持向量搜索和全文检索
- **答案生成**: 使用 **Qwen2.5-7B-Instruct** 大语言模型基于上下文生成答案
- **性能优化**: 批量处理、连接池、异步处理